<ui:composition
  template="/WEB-INF/template/LayoutPadrao.xhtml"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:p="http://primefaces.org/ui">

  <ui:define name="titulo">Cursos</ui:define>

  <ui:define name="corpo">
    <h:form id="formulario">

      <h1>Cadastro de Cursos</h1>

      <p:growl id="growl" showDetail="false" />

      <!-- Toolbar -->
      <p:toolbar style="margin-top: 20px">
        <p:toolbarGroup>
          <p:commandButton icon="pi pi-plus" value="Novo" 
                           oncomplete="PF('editarDialogWidgetVar').show()" 
                           update="editarDialog" process="@this" />
        </p:toolbarGroup>
      </p:toolbar>

      <!-- Tabela de cursos -->
      <p:dataTable id="cursosTable" var="curso" value="#{manterCursoBean.cursos}" 
                   lazy="false" showGridlines="true" 
                   style="margin-top: 20px" emptyMessage="Nenhum curso cadastrado." 
                   rows="10" paginator="true" paginatorAlwaysVisible="true" 
                   paginatorPosition="bottom" rowsPerPageTemplate="5,10,15">

        <p:column headerText="Id" style="width: 40px; text-align: center">
          <h:outputText value="#{curso.id}" />
        </p:column>

        <p:column headerText="Nome" style="width: 350px; text-align: left" 
                  filterBy="#{curso.nome}">
          <h:outputText value="#{curso.nome}" />
        </p:column>

        <p:column headerText="Disciplinas" style="width: 350px; text-align: left">
          <h:outputText value="#{curso.disciplinasFormatadas}" />
        </p:column>

        <p:column headerText="Operações" style="width: 80px; text-align: center">
          <p:commandButton icon="pi pi-pencil" title="Editar"
                           oncomplete="PF('editarDialogWidgetVar').show()"
                           update=":formulario:editarDialog" process="@this">
            <f:setPropertyActionListener target="#{manterCursoBean.curso}" value="#{curso}" />
          </p:commandButton>

          <p:commandButton icon="pi pi-trash" title="Excluir"
                           onclick="PF('confirmacaoExclusao').show();" process="@this">
            <f:setPropertyActionListener target="#{manterCursoBean.curso}" value="#{curso}" />
          </p:commandButton>
        </p:column>

      </p:dataTable>

      <!-- Dialog de edição -->
      <p:dialog id="editarDialog" header="Curso" widgetVar="editarDialogWidgetVar"
                modal="true" resizable="true" closeOnEscape="true"
                width="70%" position="center top" maximizable="true"
                height="70%" fitViewport="true" responsive="true">

        <p:panelGrid id="grid" columns="2" columnClasses="label,value">

          <p:outputLabel for="id" value="Id: " />
          <p:outputLabel id="id" value="#{manterCursoBean.curso.id}" />

          <p:outputLabel for="nome" value="Nome: " />
          <p:inputText id="nome" value="#{manterCursoBean.curso.nome}" required="true" />

          <p:outputLabel for="disciplinas" value="Disciplinas: " />
          <p:selectManyMenu id="disciplinas" value="#{manterCursoBean.curso.disciplinas}" style="width: 100%">
            <f:selectItems value="#{manterCursoBean.disciplinas}" var="d"
                           itemLabel="#{d.nome}" itemValue="#{d}" />
          </p:selectManyMenu>

          <p:commandButton icon="pi pi-save" id="salvarButton"
                           value="Salvar" title="Grava dados do Curso"
                           actionListener="#{manterCursoBean.salvar}"
                           oncomplete="if (!args.validationFailed) PF('editarDialogWidgetVar').hide()"
                           update="growl cursosTable" process="@this grid" />
        </p:panelGrid>
      </p:dialog>

      <!-- Dialog de confirmação de exclusão -->
      <p:confirmDialog id="confirmacaoExclusaoDialog" widgetVar="confirmacaoExclusao"
                       message="Tem certeza que deseja excluir o curso #{manterCursoBean.curso.nome}?"
                       header="Exclusão de curso" severity="alert">
        <p:button icon="pi pi-thumbs-down" value="Não"
                  onclick="PF('confirmacaoExclusao').hide(); return false;" process="@this"/>
        <p:commandButton icon="pi pi-thumbs-up" value="Sim" 
                         update=":formulario:cursosTable"
                         onclick="PF('confirmacaoExclusao').hide();"
                         action="#{manterCursoBean.excluir}" process="@this"/>
      </p:confirmDialog>

    </h:form>
  </ui:define>
</ui:composition>
