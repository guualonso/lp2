<ui:composition
  template="/WEB-INF/template/LayoutPadrao.xhtml"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:p="http://primefaces.org/ui">

  <ui:define name="titulo">Teste</ui:define>

  <ui:define name="corpo">

    <h:form id="formulario">

      <h1>TESTE</h1>

      <p:growl id="growl" showDetail="false" />

      <p:toolbar style="margin-top: 20px">
        <p:toolbarGroup>
          <p:commandButton icon="pi pi-plus" value="Novo" id="botaoNovo"
            oncomplete="PF('editarDialogWidgetVar').show()"
            update="editarDialog"
            process="@this"/>
        </p:toolbarGroup>
      </p:toolbar>

      <p:dataTable id="alunosTable" var="aluno" value="#{manterAlunoBean.alunos}"
        lazy="false" showGridlines="true"
        style="margin-top: 20px" emptyMessage="Nenhum aluno encontrado."
        rows="10" paginator="true" paginatorAlwaysVisible="true"
        paginatorPosition="bottom" rowsPerPageTemplate="5,10,15">

        <p:column headerText="Id" style="width: 40px; text-align: center">
          <h:outputText value="#{aluno.id}" />
        </p:column>

        <p:column headerText="Nome" style="width: 150px; text-align: left"
          filterBy="#{aluno.nome}" sortBy="#{aluno.nome}">
          <h:outputText value="#{aluno.nome}" />
        </p:column>

        <p:column headerText="Curso" style="width: 150px; text-align: left">
          <h:outputText value="#{aluno.curso.nome}" />
        </p:column>

        <p:column headerText="Email" style="width: 150px; text-align: left">
          <h:outputText value="#{aluno.email.email}" />
        </p:column>

        <p:column headerText="Salário" style="width: 150px; text-align: left"
          sortBy="#{aluno.salario}">
          <h:outputText value="#{aluno.salario}">
            <f:convertNumber pattern="#0.00" />
          </h:outputText>
        </p:column>

        <p:column headerText="Data Nasc." style="width: 150px; text-align: left">
          <h:outputText value="#{aluno.dtNasc}">
            <f:convertDateTime type="localDate" pattern="dd/MM/yyyy"/>
          </h:outputText>
        </p:column>

        <p:column headerText="Operações" style="width: 40px; text-align: center">
          <p:commandButton id="cb1" icon="pi pi-pencil" title="Editar"
            oncomplete="PF('editarDialogWidgetVar').show()"
            update=":formulario:editarDialog"
            process="@this">
            <f:setPropertyActionListener target="#{manterAlunoBean.aluno}"
              value="#{aluno}" />
          </p:commandButton>

          <p:commandButton icon="pi pi-trash" title="Excluir"
            onclick="PF('confirmacaoExclusao').show();"
            process="@this">
            <f:setPropertyActionListener target="#{manterAlunoBean.aluno}"
              value="#{aluno}" />
          </p:commandButton>
        </p:column>

      </p:dataTable>

      <p:dialog id="editarDialog" header="Aluno" widgetVar="editarDialogWidgetVar"
        modal="true" resizable="true" closeOnEscape="true"
        showEffect="explode" hideEffect="explode"
        width="100%" position="center top" maximizable="true"
        height="70%" fitViewport="true" responsive="true">

        <p:panelGrid id="grid" columns="2" columnClasses="label,value">

          <p:outputLabel for="id" value="Id: " />
          <p:outputLabel id="id" value="#{manterAlunoBean.aluno.id}" />

          <p:outputLabel for="prontuario" value="Prontuário: " />
          <p:inputText id="prontuario" value="#{manterAlunoBean.aluno.prontuario}" />

          <p:outputLabel for="nome" value="Nome: " />
          <p:inputText id="nome" value="#{manterAlunoBean.aluno.nome}" />

          <p:outputLabel for="email" value="Email: " />
          <p:inputText id="email" value="#{manterAlunoBean.aluno.email.email}" />

          <p:outputLabel for="curso" value="Curso: " />
          <p:selectOneMenu id="curso" value="#{manterAlunoBean.aluno.curso}">
            <f:selectItem itemLabel="Selecione um curso" itemValue="" />
            <f:selectItems value="#{manterAlunoBean.cursos}" var="curso"
              itemLabel="#{curso.nome}" itemValue="#{curso}" />
          </p:selectOneMenu>

          <p:outputLabel for="dtnasc" value="Data Nascimento" />
          <p:datePicker id="dtnasc" value="#{manterAlunoBean.aluno.dtNasc}" />

          <p:outputLabel for="salario" value="Salário" />
          <p:inputNumber id="salario" value="#{manterAlunoBean.aluno.salario}"
            symbol="R$ " symbolPosition="p" decimalSeparator="," thousandSeparator="." />

          <p:commandButton icon="pi pi-save" id="salvarButton"
            value="Salvar" title="Grava dados do aluno"
            actionListener="#{manterAlunoBean.salvar}"
            oncomplete="if (!args.validationFailed) PF('editarDialogWidgetVar').hide()"
            update="growl alunosTable" process="@this grid"/>
        </p:panelGrid>

      </p:dialog>

      <p:confirmDialog id="confirmacaoExclusaoDialog"
        widgetVar="confirmacaoExclusao"
        message="Tem certeza que deseja excluir o aluno #{manterAlunoBean.aluno.nome}?"
        header="Exclusão de usuário" severity="alert">

        <p:button icon="pi pi-thumbs-down" value="Não"
          onclick="PF('confirmacaoExclusao').hide(); return false;"
          process="@this"/>

        <p:commandButton icon="pi pi-thumbs-up" value="Sim"
          update=":formulario:alunosTable"
          onclick="PF('confirmacaoExclusao').hide();"
          action="#{manterAlunoBean.excluir}"
          process="@this"/>
      </p:confirmDialog>

    </h:form>
  </ui:define>
</ui:composition>
